# 数独求解器 (Sudoku Solver)

一个使用回溯算法实现的数独求解器程序，并支持调用 OpenAI GPT-5 进行纯文本解答校验。

## 功能特点

- ✅ 使用经典的回溯算法解决数独问题
- ✅ 支持手动输入数独题目
- ✅ 随机生成不同的数独题目
- ✅ 美观的棋盘显示格式
- ✅ 完整的输入验证
- ✅ 可调用 OpenAI GPT-5 文本求解并自动验证答案
- ✅ 出错时自动生成反馈，与 GPT-5 多轮对话直到回答正确或达到上限
- ✅ 支持 9x9 与 16x16 两种棋盘规模

## 使用方法

### 运行程序

```bash
python sudoku_solver.py
```

### 输入格式

程序支持两种输入方式：

1. **使用示例数独**：选择选项1，程序会使用内置的示例题目
2. **手动输入**：选择选项2，然后按提示输入9行，每行9个数字（0表示空格）

### 输入示例

```
第 1 行: 5 3 0 0 7 0 0 0 0
第 2 行: 6 0 0 1 9 5 0 0 0
...
```

## 算法说明

程序使用回溯算法（Backtracking）来解决数独：

1. 找到第一个空格
2. 尝试填入数字1-9
3. 检查填入的数字是否有效（行、列、3x3宫格）
4. 如果有效，递归解决下一个空格
5. 如果无效或导致无解，回溯并尝试下一个数字

## 示例输出

```
原始题目：
=========================
5 3 .  | . 7 .  | . . . 
6 . .  | 1 9 5  | . . . 
. 9 8  | . . .  | . 6 . 
-------------------------
8 . .  | . 6 .  | . . 3 
4 . .  | 8 . 3  | . . 1 
7 . .  | . 2 .  | . . 6 
-------------------------
. 6 .  | . . .  | 2 8 . 
. . .  | 4 1 9  | . . 5 
. . .  | . 8 .  | . 7 9 
=========================

解决方案：
...
```

## 调用 GPT-5 解答

通过 `gpt_sudoku_session.py` 可以把随机生成的数独题交给 OpenAI GPT-5 处理，并自动验证回复是否正确。每次运行都会生成一个新的题目，并在历史目录中新建一个 `session_<timestamp>/` 子目录，内部包含：

- `conversation.json`：完整的聊天记录（含 reasoning 字段，若模型返回）
- `summary.json`：本次对话概览（轮数、是否成功、最后的问题等）
- `rounds.txt`：单行记录本次使用了几轮提示

### 运行前准备

1. 在环境中设置 OpenAI API Key

   ```bash
   export OPENAI_API_KEY=sk-xxxx...
   ```

2. 安装依赖

   ```bash
   pip install --upgrade openai
   ```

### 运行脚本

```bash
python gpt_sudoku_session.py \
  --model gpt-5 \               # 可选：指定模型
  --temperature 1 \             # 可选：回复温度，默认为 1
  --holes 45 \                  # 可选：挖空数量，默认 45（中等难度）
  --history-dir ./histories \   # 可选：自定义历史目录
  --max-rounds 3 \              # 可选：最多与 GPT-5 对话轮数，默认 3
  --reset                       # 可选：启动前清空历史目录
```

程序会：

- 随机生成一个可解的数独题目，并向 GPT-5 发送提示
- 明确禁止 GPT-5 使用任何外部工具，只能在文本中给出解答
- 将会话记录保存到指定目录下独立的 `session_<timestamp>/conversation.json`
- 解析并验证 GPT-5 的解答，指出不符合数独规则的行/列/宫或与原题冲突的位置
- 若答案有误，会自动总结问题生成下一轮提示，把完整聊天记录继续带入直至回答正确或达到最大轮数
- 将每一轮的提示、回复、校验结果完整写入 JSON 记录，并额外生成 `summary.json`、`rounds.txt` 方便快速查阅

### 16x16 数独测试

我们也提供了 16x16 棋盘的 GPT 调度脚本，逻辑与 9x9 类似，但题目与校验规则针对 16x16 做了强化：

```bash
python gpt_sudoku_session_16.py \
  --model gpt-5 \                 # 可选：指定模型
  --temperature 1.0 \             # 可选：回复温度，默认为 1.0
  --holes 180 \                   # 可选：挖空数量，默认 180
  --history-dir ./histories16 \   # 可选：自定义 16x16 历史目录
  --max-rounds 10 \               # 可选：最多对话轮数，默认 10
  --reset                         # 可选：启动前清空历史目录
```

工作流程：

- 随机生成可解的 16x16 数独题目，并向 GPT-5 发送
- 明确禁止 GPT 使用任何外部工具；要求输出 16 行，每行 16 个数字
- 多轮对话自动反馈问题，直到 GPT 给出合法解答或达到最大轮数
- 所有历史写入 `session_<timestamp>/conversation.json`，并附带 `summary.json`、`rounds.txt`

## 要求

- Python 3.6+

## 作者

使用AI生成

